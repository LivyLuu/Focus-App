<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Focus Time! | Sweet Productivity</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2003/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>‚òÅÔ∏è</text></svg>">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        body { font-family: 'Inter', sans-serif; }
        .shadow-custom { box-shadow: 0 10px 30px -10px rgba(244, 114, 186, 0.5); }
        
        @keyframes pulse-ring {
            0% { transform: scale(0.8); opacity: 0.5; }
            100% { transform: scale(1.5); opacity: 0; }
        }
        .alarm-active { animation: pulse-ring 1.5s infinite; }

        .in-progress-glow {
            box-shadow: 0 0 15px rgba(219, 39, 119, 0.3);
            border: 1px solid rgba(219, 39, 119, 0.4) !important;
            background-color: #FFF5F9 !important;
        }

        .notes-scroll::-webkit-scrollbar {
            width: 4px;
        }
        .notes-scroll::-webkit-scrollbar-track {
            background: transparent;
        }
        .notes-scroll::-webkit-scrollbar-thumb {
            background: #FBCFE8;
            border-radius: 10px;
        }

        /* Drag and Drop Styles */
        .task-dragging {
            opacity: 0.5;
            transform: scale(0.98);
        }
        .drop-target-active {
            border-color: #DB2777 !important;
            background-color: rgba(219, 39, 119, 0.05) !important;
        }
    </style>
</head>
<body class="bg-[#FEE7F2]">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useRef, memo, useCallback } = React;
        
        const COLORS = {
            bg: '#FEE7F2',
            card: '#FFF0F5',
            accent: '#F472B6',
            timerPink: '#DB2777' 
        };

        const Icon = memo(({ name, size = 20, className = "" }) => {
            const iconRef = useRef(null);
            useEffect(() => {
                if (window.lucide && iconRef.current) {
                    const target = iconRef.current.querySelector('i');
                    if (target) {
                        window.lucide.createIcons({
                            icons: { [name]: window.lucide[name] || window.lucide.HelpCircle },
                            nameAttr: 'data-lucide',
                            attrs: {
                                class: className,
                                style: `width: ${size}px; height: ${size}px;`
                            }
                        });
                    }
                }
            }, [name, size, className]);
            return (
                <span ref={iconRef} className="inline-flex items-center justify-center">
                    <i data-lucide={name}></i>
                </span>
            );
        });

        const TaskItem = memo(({ 
            task, 
            sectionId,
            onDone, 
            onDelete, 
            onUpdate, 
            editingTaskId, 
            setEditingTaskId, 
            handleTaskClick,
            onDragStart
        }) => {
            const handleDragStart = (e) => {
                onDragStart(e, task.id, sectionId);
            };

            return (
                <div 
                    draggable
                    onDragStart={handleDragStart}
                    className={`group flex items-center justify-between p-4 rounded-2xl transition-all border cursor-grab active:cursor-grabbing
                        ${task.priority === 'High' ? 'bg-[#FFF0F6] border-[#DB2777]' : 'bg-white border-transparent hover:bg-rose-50/50 hover:border-rose-100'}
                        ${task.status === 'In Progress' ? 'in-progress-glow border-[#DB2777]' : ''}`}
                >
                    <div className="flex items-center gap-4 flex-1 h-full py-1">
                        <button 
                            onClick={(e) => { 
                                e.stopPropagation(); 
                                onDone(task.id);
                            }} 
                            className="text-rose-100 hover:text-emerald-400 transition-colors p-1"
                        >
                            <Icon name="CheckCircle2" size={24} />
                        </button>
                        
                        <div 
                            className="flex flex-col flex-1 select-none"
                            onClick={(e) => {
                                e.stopPropagation();
                                handleTaskClick(task.id);
                            }}
                        >
                            {editingTaskId === task.id ? (
                                <input
                                    autoFocus
                                    type="text"
                                    className="font-bold text-[#DB2777] bg-transparent border-none outline-none focus:ring-0 p-0 w-full"
                                    value={task.name}
                                    onChange={(e) => onUpdate(task.id, { name: e.target.value })}
                                    onBlur={() => setEditingTaskId(null)}
                                    onKeyDown={(e) => e.key === 'Enter' && setEditingTaskId(null)}
                                    onClick={(e) => e.stopPropagation()}
                                />
                            ) : (
                                <span className={`font-bold block ${task.status === 'In Progress' || task.priority === 'High' ? 'text-[#DB2777]' : 'text-slate-700'}`}>
                                    {task.name}
                                </span>
                            )}
                            <div className="flex items-center gap-2 mt-1">
                                {task.status === 'In Progress' && (
                                    <div className="flex items-center gap-1.5">
                                    <img src="https://behalacollege.in/display_board/assets/images/ajax-spinner.gif" alt="In Progress" className="w-10 h-10 object-contain opacity-70" />
                                                        <span className="text-[9px] px-1.5 py-0.5 rounded-md uppercase font-black tracking-widest bg-[#DB2777] text-white shadow-sm">Working</span>
                                            
                                                    </div>
                                )}
                                <div className="flex gap-1.5">
                                    {[...Array(task.target || 1)].map((_, i) => (
                                        <div key={i} className={`w-2.5 h-2.5 rounded-full ${i < task.completed ? 'bg-[#DB2777]' : (task.priority === 'High' ? 'bg-[#FBCFE8]' : 'bg-rose-100')}`} />
                                    ))}
                                </div>
                            </div>
                        </div>
                    </div>
                    <div className="flex items-center gap-2">
                        <div className="text-rose-200 cursor-grab active:cursor-grabbing">
                            <Icon name="GripVertical" size={16} />
                        </div>
                        <button 
                            onClick={(e) => { e.stopPropagation(); onDelete(task.id); }}
                            className={`p-2 rounded-xl transition-all ${task.priority === 'High' ? 'text-[#DB2777] hover:text-red-700' : 'opacity-0 group-hover:opacity-100 text-rose-200 hover:text-red-400'}`}
                        >
                            <Icon name="Trash2" size={18} />
                        </button>
                    </div>
                </div>
            );
        });

        const TaskSection = memo(({ 
            section, 
            sectionsCount, 
            deleteSection, 
            addTaskToSection, 
            updateSectionTitle, 
            isEditingTitleId, 
            setIsEditingTitleId,
            updateTaskInSections,
            deleteTaskFromSections,
            editingTaskId,
            setEditingTaskId,
            handleTaskClick,
            onDragStart,
            onDropTask
        }) => {
            const [localNewTaskName, setLocalNewTaskName] = useState('');
            const [localNewTaskPriority, setLocalNewTaskPriority] = useState('Medium');
            const [isOver, setIsOver] = useState(false);
            const pendingTasks = section.tasks.filter(t => t.status !== 'Done');

            const handleAdd = () => {
                if (!localNewTaskName.trim()) return;
                addTaskToSection(section.id, localNewTaskName, localNewTaskPriority);
                setLocalNewTaskName('');
            };

            const handleDragOver = (e) => {
                e.preventDefault();
                setIsOver(true);
            };

            const handleDragLeave = () => {
                setIsOver(false);
            };

            const handleDrop = (e) => {
                e.preventDefault();
                setIsOver(false);
                onDropTask(section.id);
            };

            return (
                <div 
                    onDragOver={handleDragOver}
                    onDragLeave={handleDragLeave}
                    onDrop={handleDrop}
                    className={`bg-white rounded-[2.5rem] shadow-xl overflow-hidden mb-8 transition-all border-4 ${isOver ? 'border-[#DB2777] bg-rose-50/30' : 'border-transparent'}`}
                >
                    <div className="p-8 border-b border-rose-50 flex justify-between items-center">
                        <div className="flex-1">
                            {isEditingTitleId === section.id ? (
                                <input
                                    autoFocus
                                    type="text"
                                    className="font-black text-xl bg-transparent border-none outline-none focus:ring-0 p-0 w-full"
                                    style={{ color: COLORS.timerPink }}
                                    value={section.title}
                                    onChange={(e) => updateSectionTitle(section.id, e.target.value)}
                                    onBlur={() => setIsEditingTitleId(null)}
                                    onKeyDown={(e) => e.key === 'Enter' && setIsEditingTitleId(null)}
                                />
                            ) : (
                                <h3 
                                    style={{ color: COLORS.timerPink }} 
                                    className="font-black text-xl cursor-text select-none"
                                    onDoubleClick={() => setIsEditingTitleId(section.id)}
                                >
                                    {section.title}
                                </h3>
                            )}
                        </div>
                        {sectionsCount > 1 && (
                            <button onClick={() => deleteSection(section.id)} className="text-rose-200 hover:text-rose-400 transition-colors p-2">
                                <Icon name="Trash2" size={18} />
                            </button>
                        )}
                    </div>
                    <div className="p-8 bg-[#FFF0F5]/30 flex flex-wrap gap-4">
                        <input 
                            type="text" 
                            placeholder="What's next?" 
                            value={localNewTaskName} 
                            onChange={(e) => setLocalNewTaskName(e.target.value)} 
                            onKeyDown={(e) => e.key === 'Enter' && handleAdd()}
                            className="flex-1 min-w-[200px] px-6 py-4 rounded-2xl border-2 border-rose-100 focus:outline-none focus:border-[#DB2777]" 
                        />
                        <select 
                            value={localNewTaskPriority} 
                            onChange={(e) => setLocalNewTaskPriority(e.target.value)}
                            className="px-4 py-4 rounded-2xl border-2 border-rose-100 bg-white font-bold text-rose-400 focus:border-[#DB2777] focus:outline-none"
                        >
                            <option>High</option>
                            <option>Medium</option>
                            <option>Low</option>
                        </select>
                        <button 
                            onClick={handleAdd} 
                            className="bg-slate-800 text-white px-8 py-4 rounded-2xl hover:bg-slate-900 transition-all font-bold"
                        >
                            Add
                        </button>
                    </div>
                    <div className="p-4 space-y-2 min-h-[100px]">
                        {pendingTasks.map((task) => (
                            <TaskItem 
                                key={task.id}
                                task={task}
                                sectionId={section.id}
                                onDone={(id) => {
                                    updateTaskInSections(id, (t) => ({ status: 'Done' }));
                                }}
                                onDelete={deleteTaskFromSections}
                                onUpdate={(id, updates) => updateTaskInSections(id, () => updates)}
                                editingTaskId={editingTaskId}
                                setEditingTaskId={setEditingTaskId}
                                handleTaskClick={handleTaskClick}
                                onDragStart={onDragStart}
                            />
                        ))}
                        {pendingTasks.length === 0 && (
                            <div className="h-20 flex items-center justify-center border-2 border-dashed border-rose-100 rounded-2xl">
                                <p className="text-rose-200 text-sm italic font-medium">Empty section...</p>
                            </div>
                        )}
                    </div>
                </div>
            );
        });

        const App = () => {
            const [sections, setSections] = useState([
                { id: 'sec-1', title: '‚ú® Tasks', tasks: [] }
            ]);
            
            // Drag and Drop Internal State
            const draggedTaskRef = useRef(null);

            const [isSideQuestsOpen, setIsSideQuestsOpen] = useState(false);
            const [sideQuests, setSideQuests] = useState([
                { id: 1, text: "Hydrate! Drink some water üíß" }
            ]);
            const [newQuest, setNewQuest] = useState('');
            const [editingQuestId, setEditingQuestId] = useState(null);

            const [activeTaskId, setActiveTaskId] = useState(null);
            const [timerMode, setTimerMode] = useState('focus'); 
            const [timeLeft, setTimeLeft] = useState(1500); 
            const [isActive, setIsActive] = useState(false);
            const [view, setView] = useState('tracker'); 
            const [isAlarmPlaying, setIsAlarmPlaying] = useState(false);
            
            const [isEditingTitleId, setIsEditingTitleId] = useState(null);
            const [editingTaskId, setEditingTaskId] = useState(null);
            
            const clickTimer = useRef(null);
            const audioContextRef = useRef(null);
            const alarmIntervalRef = useRef(null);

            const handleDragStart = useCallback((e, taskId, sourceSectionId) => {
                draggedTaskRef.current = { taskId, sourceSectionId };
                e.dataTransfer.effectAllowed = 'move';
            }, []);

            const handleDropTask = useCallback((targetSectionId) => {
                if (!draggedTaskRef.current) return;
                const { taskId, sourceSectionId } = draggedTaskRef.current;

                setSections(prevSections => {
                    // Find the task object
                    let taskToMove = null;
                    const newSections = prevSections.map(section => {
                        if (section.id === sourceSectionId) {
                            taskToMove = section.tasks.find(t => t.id === taskId);
                            return {
                                ...section,
                                tasks: section.tasks.filter(t => t.id !== taskId)
                            };
                        }
                        return section;
                    });

                    if (!taskToMove) return prevSections;

                    // Add to target section
                    return newSections.map(section => {
                        if (section.id === targetSectionId) {
                            return {
                                ...section,
                                tasks: [...section.tasks, taskToMove]
                            };
                        }
                        return section;
                    });
                });

                draggedTaskRef.current = null;
            }, []);

            const playChime = useCallback(() => {
                try {
                    if (!audioContextRef.current) {
                        audioContextRef.current = new (window.AudioContext || window.webkitAudioContext)();
                    }
                    const ctx = audioContextRef.current;
                    if (ctx.state === 'suspended') ctx.resume();
                    const osc = ctx.createOscillator();
                    const gain = ctx.createGain();
                    osc.type = 'sine';
                    osc.frequency.setValueAtTime(880, ctx.currentTime); 
                    osc.frequency.exponentialRampToValueAtTime(440, ctx.currentTime + 0.5);
                    gain.gain.setValueAtTime(0.1, ctx.currentTime);
                    gain.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + 0.5);
                    osc.connect(gain);
                    gain.connect(ctx.destination);
                    osc.start();
                    osc.stop(ctx.currentTime + 0.5);
                } catch (e) { console.error("Audio error:", e); }
            }, []);

            const startAlarm = useCallback(() => {
                setIsAlarmPlaying(true);
                playChime();
                if (alarmIntervalRef.current) clearInterval(alarmIntervalRef.current);
                alarmIntervalRef.current = setInterval(playChime, 2500); 
            }, [playChime]);

            const stopAlarm = useCallback(() => {
                setIsAlarmPlaying(false);
                if (alarmIntervalRef.current) {
                    clearInterval(alarmIntervalRef.current);
                    alarmIntervalRef.current = null;
                }
            }, []);

            useEffect(() => {
                let interval = null;
                if (isActive && timeLeft > 0) {
                    interval = setInterval(() => { 
                        setTimeLeft((prev) => {
                            if (prev <= 1) {
                                setIsActive(false);
                                startAlarm();
                                return 0;
                            }
                            return prev - 1;
                        }); 
                    }, 1000);
                }
                return () => clearInterval(interval);
            }, [isActive, timeLeft, startAlarm]);

            useEffect(() => {
                if (timeLeft === 0 && !isActive && timerMode === 'focus' && activeTaskId) {
                    setSections(prev => prev.map(section => ({
                        ...section,
                        tasks: section.tasks.map(t => t.id === activeTaskId ? { ...t, completed: t.completed + 1 } : t)
                    })));
                }
            }, [timeLeft, isActive, timerMode, activeTaskId]);

            const resetTimer = (mode) => {
                stopAlarm();
                setTimerMode(mode);
                const times = { focus: 1500, shortBreak: 5, longBreak: 900 };
                setTimeLeft(times[mode]); 
                setIsActive(false);
            };

            const formatTime = (seconds) => {
                const mins = Math.floor(seconds / 60);
                const secs = seconds % 60;
                return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
            };

            const addNewSection = useCallback(() => {
                setSections(s => [...s, { id: `sec-${Date.now()}`, title: '‚ú® New Section', tasks: [] }]);
            }, []);

            const deleteSection = useCallback((sectionId) => {
                setSections(s => s.length <= 1 ? s : s.filter(sec => sec.id !== sectionId));
            }, []);

            const addTaskToSection = useCallback((sectionId, name, priority) => {
                setSections(s => s.map(sec => {
                    if (sec.id === sectionId) {
                        return {
                            ...sec,
                            tasks: [...sec.tasks, { id: Date.now(), name, priority, target: 1, completed: 0, status: 'Pending' }]
                        };
                    }
                    return sec;
                }));
            }, []);

            const updateSectionTitle = useCallback((sectionId, newTitle) => {
                setSections(s => s.map(sec => sec.id === sectionId ? { ...sec, title: newTitle } : sec));
            }, []);

            const updateTaskInSections = useCallback((taskId, updater) => {
                setSections(s => s.map(sec => ({
                    ...sec,
                    tasks: sec.tasks.map(t => t.id === taskId ? { ...t, ...updater(t) } : t)
                })));
            }, []);

            const deleteTaskFromSections = useCallback((taskId) => {
                setSections(s => s.map(sec => ({
                    ...sec,
                    tasks: sec.tasks.filter(t => t.id !== taskId)
                })));
                setActiveTaskId(current => current === taskId ? null : current);
            }, []);

            const toggleTaskActivation = useCallback((id) => {
                setSections(s => {
                    let foundTask = null;
                    s.forEach(sec => {
                        const tk = sec.tasks.find(t => t.id === id);
                        if (tk) foundTask = tk;
                    });
                    if (!foundTask) return s;

                    const isCurrentlyActive = foundTask.status === 'In Progress';
                    if (!isCurrentlyActive) setActiveTaskId(id);
                    else setActiveTaskId(current => current === id ? null : current);

                    return s.map(sec => ({
                        ...sec,
                        tasks: sec.tasks.map(t => {
                            if (t.id === id) return { ...t, status: isCurrentlyActive ? 'Pending' : 'In Progress' };
                            if (t.status === 'In Progress') return { ...t, status: 'Pending' };
                            return t;
                        })
                    }));
                });
            }, []);

            const handleTaskClick = useCallback((taskId) => {
                if (clickTimer.current) {
                    clearTimeout(clickTimer.current);
                    clickTimer.current = null;
                    setEditingTaskId(taskId);
                } else {
                    clickTimer.current = setTimeout(() => {
                        toggleTaskActivation(taskId);
                        clickTimer.current = null;
                    }, 250); 
                }
            }, [toggleTaskActivation]);

            const addQuest = () => {
                if (!newQuest.trim()) return;
                setSideQuests([...sideQuests, { id: Date.now(), text: newQuest }]);
                setNewQuest('');
            };

            const stats = useMemo(() => {
                const allTasks = sections.flatMap(s => s.tasks);
                return { 
                    total: allTasks.length, 
                    done: allTasks.filter(t => t.status === 'Done').length, 
                    totalPoms: allTasks.reduce((acc, t) => acc + t.completed, 0),
                };
            }, [sections]);

            return (
                <div className="min-h-screen p-4 md:p-8 text-slate-700">
                    <div className="max-w-6xl mx-auto flex flex-col md:flex-row gap-8">
                        <aside className="w-full md:w-72 space-y-6">
                            <div className="bg-white/80 backdrop-blur-md p-6 rounded-[2rem] shadow-xl border border-white/50">
                                <h1 style={{ color: COLORS.timerPink }} className="text-2xl font-black flex items-center gap-2 mb-8">
                                    <span className="text-3xl">‚òÅÔ∏è</span> Focus Time!
                                </h1>
                                <nav className="space-y-3">
                                    <button onClick={() => setView('tracker')} className={`w-full flex items-center gap-3 px-5 py-4 rounded-2xl transition-all ${view === 'tracker' ? 'bg-[#DB2777] text-white shadow-lg' : 'text-rose-400 hover:bg-rose-50'}`}>
                                        <Icon name="ListTodo" /> <span className="font-bold">Task Tracker</span>
                                    </button>
                                    <button onClick={() => setView('dashboard')} className={`w-full flex items-center gap-3 px-5 py-4 rounded-2xl transition-all ${view === 'dashboard' ? 'bg-[#DB2777] text-white shadow-lg' : 'text-rose-400 hover:bg-rose-50'}`}>
                                        <Icon name="BarChart3" /> <span className="font-bold">Dashboard</span>
                                    </button>
                                </nav>
                            </div>

                            <div className="bg-white p-3 rounded-[2rem] shadow-xl border-4 border-white overflow-hidden">
                                <div className="aspect-video w-full rounded-2xl overflow-hidden shadow-inner bg-slate-100">
                                    <iframe width="100%" height="100%" src="https://www.youtube.com/embed/jfKfPfyJRdk?autoplay=1&origin=https://localhost" title="Lofi Music" frameBorder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowFullScreen></iframe>
                                </div>
                                <div className="mt-3 px-2 text-center">
                                    <p style={{ color: COLORS.timerPink }} className="font-bold text-xs">Now Playing: Lofi Beats üéµ</p>
                                    <p className="text-[10px] text-rose-300 uppercase tracking-widest font-bold mt-1">Focus Mode: ON</p>
                                </div>
                            </div>

                            <div className="bg-white/50 rounded-[2rem] shadow-sm overflow-hidden border border-white/60 transition-all">
                                <button onClick={() => setIsSideQuestsOpen(!isSideQuestsOpen)} className="w-full p-5 flex items-center justify-between hover:bg-white/30 transition-colors">
                                    <div className="flex items-center gap-3">
                                        <Icon name="Sparkles" size={18} className="text-[#DB2777]" />
                                        <span className="text-[11px] text-rose-400 uppercase tracking-widest font-black">Side Quests</span>
                                    </div>
                                    <Icon name={isSideQuestsOpen ? "ChevronUp" : "ChevronDown"} size={16} className="text-rose-300" />
                                </button>
                                {isSideQuestsOpen && (
                                    <div className="px-5 pb-5 space-y-4 animate-in fade-in slide-in-from-top-2">
                                        <div className="max-h-64 overflow-y-auto notes-scroll space-y-2">
                                            {sideQuests.map((quest) => (
                                                <div key={quest.id} className="flex items-start justify-between bg-white/40 p-3 rounded-xl text-xs group hover:bg-white/60 transition-colors">
                                                    <div className="flex-1 pr-2">
                                                        {editingQuestId === quest.id ? (
                                                            <textarea autoFocus className="w-full bg-transparent border-none outline-none text-[#DB2777] font-medium resize-none p-0" value={quest.text} onChange={(e) => setSideQuests(sideQuests.map(q => q.id === quest.id ? {...q, text: e.target.value} : q))} onBlur={() => setEditingQuestId(null)} onKeyDown={(e) => e.key === 'Enter' && setEditingQuestId(null)} rows={2} />
                                                        ) : (
                                                            <span onDoubleClick={() => setEditingQuestId(quest.id)} className="text-rose-500 font-medium break-words whitespace-pre-wrap block">{quest.text}</span>
                                                        )}
                                                    </div>
                                                    <button onClick={() => setSideQuests(sideQuests.filter(q => q.id !== quest.id))} className="opacity-0 group-hover:opacity-100 text-rose-300 hover:text-rose-500 transition-all flex-shrink-0 pt-0.5"><Icon name="X" size={14} /></button>
                                                </div>
                                            ))}
                                        </div>
                                        <div className="flex gap-2">
                                            <input type="text" placeholder="New quest..." value={newQuest} onChange={(e) => setNewQuest(e.target.value)} onKeyDown={(e) => e.key === 'Enter' && addQuest()} className="flex-1 bg-white/60 border-none text-xs p-2 rounded-lg outline-none text-rose-600 placeholder:text-rose-200" />
                                            <button onClick={addQuest} className="p-2 bg-[#DB2777] text-white rounded-lg hover:bg-[#9D174D] transition-all"><Icon name="Plus" size={14} /></button>
                                        </div>
                                    </div>
                                )}
                            </div>
                        </aside>

                        <main className="flex-1 space-y-6">
                            {view === 'tracker' ? (
                                <>
                                    <div className="bg-white p-10 rounded-[3rem] shadow-2xl flex flex-col items-center text-center relative mb-12">
                                        <div className="flex gap-2 mb-10 bg-rose-50/50 p-1.5 rounded-full border border-rose-100">
                                            {['focus', 'shortBreak', 'longBreak'].map((m) => (
                                                <button key={m} onClick={() => resetTimer(m)} className={`px-6 py-2 rounded-full text-sm font-bold transition-all ${timerMode === m ? 'bg-white shadow-md text-[#DB2777]' : 'text-rose-300 hover:text-rose-500'}`}>{m.replace('Break', '')}</button>
                                            ))}
                                        </div>
                                        <div className="relative mb-10">
                                            {isAlarmPlaying && <div className="absolute inset-0 rounded-full border-8 border-rose-200 alarm-active"></div>}
                                            <h2 style={{ color: COLORS.timerPink }} className="text-9xl font-black tracking-tighter tabular-nums">{formatTime(timeLeft)}</h2>
                                        </div>
                                        <div className="flex items-center gap-5">
                                            {isAlarmPlaying ? (
                                                <button onClick={stopAlarm} className="w-64 py-5 rounded-[2rem] flex items-center justify-center gap-3 text-xl font-black bg-emerald-500 text-white shadow-lg animate-bounce"><Icon name="BellOff" /> STOP ALARM</button>
                                            ) : (
                                                <>
                                                    <button onClick={() => setIsActive(!isActive)} className="w-48 py-5 rounded-[2rem] flex items-center justify-center gap-3 text-xl font-black shadow-custom bg-[#DB2777] text-white hover:bg-[#9D174D] transition-all">{isActive ? 'PAUSE' : 'START'}</button>
                                                    <button onClick={() => resetTimer(timerMode)} className="p-5 bg-rose-50 text-rose-300 rounded-[1.5rem] hover:text-[#DB2777] transition-all"><Icon name="RotateCcw" size={24} /></button>
                                                </>
                                            )}
                                        </div>
                                    </div>

                                    {sections.map(section => (
                                        <TaskSection 
                                            key={section.id} 
                                            section={section} 
                                            sectionsCount={sections.length}
                                            deleteSection={deleteSection}
                                            addTaskToSection={addTaskToSection}
                                            updateSectionTitle={updateSectionTitle}
                                            isEditingTitleId={isEditingTitleId}
                                            setIsEditingTitleId={setIsEditingTitleId}
                                            updateTaskInSections={updateTaskInSections}
                                            deleteTaskFromSections={deleteTaskFromSections}
                                            editingTaskId={editingTaskId}
                                            setEditingTaskId={setEditingTaskId}
                                            handleTaskClick={handleTaskClick}
                                            onDragStart={handleDragStart}
                                            onDropTask={handleDropTask}
                                        />
                                    ))}

                                    <button 
                                        onClick={addNewSection}
                                        className="w-full p-6 border-2 border-dashed border-rose-200 rounded-[2.5rem] text-rose-300 font-bold flex items-center justify-center gap-3 hover:bg-white/50 hover:border-[#DB2777] hover:text-[#DB2777] transition-all"
                                    >
                                        <Icon name="PlusCircle" /> Add Section
                                    </button>
                                </>
                            ) : (
                                <div className="space-y-6">
                                    <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                                        <div className="bg-white p-8 rounded-[2.5rem] shadow-xl text-center">
                                            <p className="text-rose-300 text-xs font-black uppercase tracking-widest mb-2">Poms Completed</p>
                                            <p style={{ color: COLORS.timerPink }} className="text-5xl font-black">{stats.totalPoms}</p>
                                        </div>
                                        <div className="bg-white p-8 rounded-[2.5rem] shadow-xl text-center">
                                            <p className="text-rose-300 text-xs font-black uppercase tracking-widest mb-2">Tasks Done</p>
                                            <p style={{ color: COLORS.timerPink }} className="text-5xl font-black">{stats.done}</p>
                                        </div>
                                        <div className="bg-white p-8 rounded-[2.5rem] shadow-xl text-center">
                                            <p className="text-rose-300 text-xs font-black uppercase tracking-widest mb-2">Completion Rate</p>
                                            <p style={{ color: COLORS.timerPink }} className="text-5xl font-black">{stats.total > 0 ? Math.round((stats.done / stats.total) * 100) : 0}%</p>
                                        </div>
                                    </div>
                                </div>
                            )}
                        </main>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
